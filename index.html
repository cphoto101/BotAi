<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Stream Mini App - No Storage Version</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        :root { --bg: #121212; --card: #1e1e1e; --accent: #0088cc; --text: #ffffff; }
        body { margin: 0; background: var(--bg); color: var(--text); font-family: sans-serif; }
        
        /* Loading Screen */
        #loader { position: fixed; inset: 0; background: var(--bg); z-index: 99; display: flex; flex-direction: column; justify-content: center; align-items: center; transition: 0.5s; }
        .spin { border: 3px solid #333; border-top: 3px solid var(--accent); border-radius: 50%; width: 30px; height: 30px; animation: s 1s linear infinite; }
        @keyframes s { to { transform: rotate(360deg); } }

        .container { padding: 15px; max-width: 500px; margin: auto; }
        .tabs { display: flex; background: var(--card); border-radius: 10px; padding: 4px; margin-bottom: 15px; }
        .tab { flex: 1; text-align: center; padding: 10px; cursor: pointer; border-radius: 8px; }
        .tab.active { background: var(--accent); font-weight: bold; }

        #adminPanel { background: var(--card); padding: 15px; border-radius: 12px; border: 1px solid var(--accent); margin-bottom: 20px; display: none; }
        input, textarea { width: 100%; padding: 10px; margin: 5px 0; border-radius: 8px; border: 1px solid #333; background: #252525; color: white; box-sizing: border-box; }
        button { width: 100%; padding: 12px; border: none; border-radius: 8px; background: var(--accent); color: white; font-weight: bold; margin-top: 10px; }

        .movie-card { background: var(--card); border-radius: 12px; margin-bottom: 12px; display: flex; overflow: hidden; }
        .movie-card img { width: 90px; height: 130px; object-fit: cover; }
        .m-info { padding: 10px; flex: 1; }
        .music-card { background: var(--card); border-radius: 12px; padding: 15px; margin-bottom: 12px; }
        audio { width: 100%; margin-top: 10px; filter: invert(100%); }
        .hidden { display: none; }
    </style>
</head>
<body>

    <div id="loader">
        <div class="spin"></div>
        <p id="greet">Initializing...</p>
    </div>

    <div class="container">
        <div id="adminPanel">
            <div id="loginSection">
                <input type="email" id="email" placeholder="Admin Email">
                <input type="password" id="pass" placeholder="Password">
                <button onclick="adminLogin()">Login</button>
            </div>
            <div id="uploadSection" class="hidden">
                <h4 style="margin:0 0 10px 0;">Upload Content</h4>
                <select id="upType" onchange="toggleForm()" style="width:100%; padding:8px; border-radius:5px; background:#252525; color:white;">
                    <option value="movie">Movie</option>
                    <option value="music">Music</option>
                </select>
                <div id="mForm">
                    <input type="text" id="mTitle" placeholder="Movie Title">
                    <input type="text" id="mImg" placeholder="Image URL (Link)">
                    <input type="text" id="mKey" placeholder="Access Key">
                    <textarea id="mReview" placeholder="Review..."></textarea>
                </div>
                <div id="muForm" class="hidden">
                    <input type="text" id="muTitle" placeholder="Song Title">
                    <input type="text" id="muUrl" placeholder="MP3 URL (Link)">
                    <textarea id="muLyrics" placeholder="Lyrics..."></textarea>
                </div>
                <button onclick="postData()">Post Now</button>
                <button onclick="logout()" style="background:#444; margin-top:5px;">Logout</button>
            </div>
        </div>

        <div class="tabs">
            <div class="tab active" onclick="setTab('movie')">Movies</div>
            <div class="tab" onclick="setTab('music')">Music</div>
        </div>

        <div id="movieList"></div>
        <div id="musicList" class="hidden"></div>
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/9.22.0/firebase-app.js";
        import { getAuth, signInWithEmailAndPassword, signOut, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/9.22.0/firebase-auth.js";
        import { getFirestore, collection, addDoc, onSnapshot, query, orderBy } from "https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore.js";

        const firebaseConfig = {
            apiKey: "AIzaSyCdyEiklUPrEL6TklIDyOh_F-PhgCyCjLw",
            authDomain: "zzaro0.firebaseapp.com",
            projectId: "zzaro0",
            storageBucket: "zzaro0.firebasestorage.app", // á€’á€«á€€ á€€á€¯á€’á€ºá€‘á€²á€™á€¾á€¬á€•á€²á€›á€¾á€­á€”á€±á€™á€¾á€¬á€•á€«áŠ á€á€€á€šá€ºá€™á€žá€¯á€¶á€¸á€á€±á€¬á€·á€•á€«
            messagingSenderId: "197891222875",
            appId: "1:197891222875:web:8897ba4de2829eeb0d3e7e"
        };

        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getFirestore(app);

        const tg = window.Telegram.WebApp;
        tg.expand();

        // âš ï¸ Admin Telegram ID 
        const ADMIN_ID = 1924452453; 

        window.onload = () => {
            const u = tg.initDataUnsafe.user;
            if(u) document.getElementById('greet').innerText = `Hello, ${u.first_name}!`;
            if(u && u.id === ADMIN_ID) document.getElementById('adminPanel').style.display = 'block';
            setTimeout(() => document.getElementById('loader').style.display = 'none', 1500);
        };

        // Auth
        onAuthStateChanged(auth, user => {
            document.getElementById('loginSection').classList.toggle('hidden', !!user);
            document.getElementById('uploadSection').classList.toggle('hidden', !user);
        });

        window.adminLogin = () => {
            signInWithEmailAndPassword(auth, document.getElementById('email').value, document.getElementById('pass').value)
            .catch(e => alert(e.message));
        };
        window.logout = () => signOut(auth);

        window.toggleForm = () => {
            const isM = document.getElementById('upType').value === 'movie';
            document.getElementById('mForm').classList.toggle('hidden', !isM);
            document.getElementById('muForm').classList.toggle('hidden', isM);
        };

        window.setTab = t => {
            document.querySelectorAll('.tab').forEach(el => el.classList.remove('active'));
            event.target.classList.add('active');
            document.getElementById('movieList').classList.toggle('hidden', t !== 'movie');
            document.getElementById('musicList').classList.toggle('hidden', t !== 'music');
        };

        window.postData = async () => {
            const type = document.getElementById('upType').value;
            try {
                if(type === 'movie') {
                    await addDoc(collection(db, "movies"), {
                        t: document.getElementById('mTitle').value,
                        i: document.getElementById('mImg').value,
                        k: document.getElementById('mKey').value,
                        r: document.getElementById('mReview').value,
                        date: Date.now()
                    });
                } else {
                    await addDoc(collection(db, "music"), {
                        t: document.getElementById('muTitle').value,
                        u: document.getElementById('muUrl').value,
                        l: document.getElementById('muLyrics').value,
                        date: Date.now()
                    });
                }
                alert("Posted!");
            } catch(e) { alert(e.message); }
        };

        // Realtime Data
        onSnapshot(query(collection(db, "movies"), orderBy("date", "desc")), s => {
            const list = document.getElementById('movieList');
            list.innerHTML = "";
            s.forEach(doc => {
                const d = doc.data();
                list.innerHTML += `<div class="movie-card">
                    <img src="${d.i}">
                    <div class="m-info">
                        <h4 style="margin:0;">${d.t}</h4>
                        <small style="color:var(--accent)">Key: ${d.k}</small>
                        <p style="font-size:12px; color:#aaa; margin-top:5px;">${d.r}</p>
                    </div>
                </div>`;
            });
        });

        onSnapshot(query(collection(db, "music"), orderBy("date", "desc")), s => {
            const list = document.getElementById('musicList');
            list.innerHTML = "";
            s.forEach(doc => {
                const d = doc.data();
                list.innerHTML += `<div class="music-card">
                    <h4 style="margin:0;">ðŸŽµ ${d.t}</h4>
                    <audio controls src="${d.u}"></audio>
                    <p style="font-size:12px; color:#aaa; white-space:pre-line; margin-top:10px;">${d.l}</p>
                </div>`;
            });
        });
    </script>
</body>
</html>
