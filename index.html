<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>AI Media Bot</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600&display=swap" rel="stylesheet">

    <style>
        /* CSS ဒီအတိုင်းထားပါ - မူရင်း CSS အတိုင်း */
        :root { --bg-color: #0f0f13; --card-bg: rgba(255, 255, 255, 0.08); --primary: #9b51e0; --secondary: #bb6bd9; --text-main: #ffffff; --text-sub: #a0a0a0; --highlight: #00ff88; }
        * { box-sizing: border-box; margin: 0; padding: 0; user-select: none; }
        body { font-family: 'Poppins', sans-serif; background-color: var(--bg-color); color: var(--text-main); height: 100vh; overflow: hidden; }
        .app-container { padding: 20px; height: 100%; display: flex; flex-direction: column; }
        .header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px; }
        .tabs { display: flex; background: rgba(255,255,255,0.05); border-radius: 12px; padding: 4px; margin-bottom: 15px; }
        .tab-item { flex: 1; text-align: center; padding: 10px; border-radius: 10px; color: var(--text-sub); cursor: pointer; transition: 0.3s; font-size: 14px; }
        .tab-item.active { background: var(--primary); color: white; font-weight: 600; }
        .search-box { background: var(--card-bg); border-radius: 15px; padding: 12px 15px; display: flex; align-items: center; margin-bottom: 20px; }
        .search-box input { background: transparent; border: none; color: white; width: 100%; margin-left: 10px; outline: none; }
        .content-list { flex: 1; overflow-y: auto; padding-bottom: 100px; }
        .media-item { display: flex; align-items: center; padding: 12px; margin-bottom: 10px; background: var(--card-bg); border-radius: 12px; cursor: pointer; }
        .media-img { width: 60px; height: 60px; border-radius: 10px; object-fit: cover; margin-right: 15px; position: relative; }
        .movie-tag { position: absolute; bottom: 5px; right: 5px; background: rgba(0,0,0,0.7); color: white; font-size: 8px; padding: 2px 4px; border-radius: 4px; }
        .video-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: black; z-index: 200; display: none; align-items: center; justify-content: center; flex-direction: column; }
        .video-overlay.active { display: flex; }
        .video-wrapper { width: 100%; max-width: 800px; position: relative; }
        video { width: 100%; }
        .close-video { position: absolute; top: 20px; right: 20px; color: white; font-size: 24px; cursor: pointer; z-index: 201; background: rgba(0,0,0,0.5); width: 40px; height: 40px; border-radius: 50%; display: flex; align-items: center; justify-content: center; }
        .full-player { position: fixed; top: 100%; left: 0; width: 100%; height: 100%; background: rgba(15, 15, 19, 0.98); transition: top 0.4s; z-index: 150; padding: 30px 20px; display: flex; flex-direction: column; align-items: center; }
        .full-player.active { top: 0; }
        .disk-wrapper { width: 200px; height: 200px; border-radius: 50%; overflow: hidden; animation: rotate 20s linear infinite; animation-play-state: paused; border: 4px solid rgba(255,255,255,0.1); margin-top: 40px;}
        .disk-wrapper.playing { animation-play-state: running; }
        .disk-wrapper img { width: 100%; height: 100%; object-fit: cover; }
        @keyframes rotate { from { transform: rotate(0deg); } to { transform: rotate(360deg); } }
        .player-controls { display: flex; gap: 20px; align-items: center; margin-top: 20px; }
        .btn-play { width: 60px; height: 60px; border-radius: 50%; background: var(--primary); border: none; color: white; font-size: 24px; }
        .back-btn { position: absolute; top: 20px; left: 20px; color: white; font-size: 24px; }
    </style>
</head>
<body>

    <div class="app-container">
        <div class="header">
            <h2>Media Hub</h2>
            <i class="fas fa-sync-alt" onclick="loadMedia()" style="color: var(--highlight); cursor: pointer;"></i>
        </div>

        <div class="tabs">
            <div class="tab-item active" onclick="switchTab('music')">Music</div>
            <div class="tab-item" onclick="switchTab('movie')">Movies</div>
        </div>

        <div class="search-box">
            <i class="fas fa-search" style="color: var(--text-sub);"></i>
            <input type="text" id="searchInput" placeholder="Search...">
        </div>

        <div id="loading" style="text-align:center; color: var(--text-sub); margin-top: 20px;">
            <i class="fas fa-spinner fa-spin"></i> Loading media...
        </div>

        <div class="content-list" id="contentList"></div>
    </div>

    <div class="video-overlay" id="videoPlayerOverlay">
        <div class="close-video" onclick="closeVideo()"><i class="fas fa-times"></i></div>
        <div class="video-wrapper">
            <video id="mainVideo" controls controlsList="nodownload">
                <source src="" type="video/mp4">
            </video>
        </div>
        <div style="padding: 20px; color: white; text-align: center;">
            <h3 id="vidTitle">Movie Title</h3>
        </div>
    </div>

    <div class="full-player" id="musicPlayerOverlay">
        <div class="back-btn" onclick="closeMusic()"><i class="fas fa-chevron-down"></i></div>
        <div class="disk-wrapper" id="disk">
            <img src="" id="musicCover">
        </div>
        <h2 id="musicTitle" style="margin-top: 20px;">Title</h2>
        <p id="musicArtist" style="color: var(--text-sub);">Artist</p>
        <div class="player-controls">
            <button class="btn-play" onclick="toggleAudio()"><i class="fas fa-play" id="audioPlayIcon"></i></button>
        </div>
    </div>
    <audio id="audioElement"></audio>

    <script>
        const tg = window.Telegram.WebApp;
        tg.expand();

        let mediaData = []; // Data will be fetched from Python
        let currentTab = 'music';
        
        const listEl = document.getElementById('contentList');
        const audioEl = document.getElementById('audioElement');
        const videoEl = document.getElementById('mainVideo');
        const loadingEl = document.getElementById('loading');

        // Fetch Data from Python Backend
        async function loadMedia() {
            loadingEl.style.display = 'block';
            listEl.innerHTML = '';
            
            try {
                // Flask Route ကို လှမ်းခေါ်ခြင်း
                const response = await fetch('/api/media');
                mediaData = await response.json();
                
                loadingEl.style.display = 'none';
                renderList(document.getElementById('searchInput').value);
            } catch (error) {
                loadingEl.innerHTML = "Error connecting to bot.";
                console.error(error);
            }
        }

        function renderList(filter = '') {
            listEl.innerHTML = '';
            const filtered = mediaData.filter(item => 
                item.type === currentTab && 
                item.title.toLowerCase().includes(filter.toLowerCase())
            );

            if (filtered.length === 0) {
                listEl.innerHTML = '<div style="text-align:center; color:#555; margin-top:20px;">No items found</div>';
                return;
            }

            filtered.forEach(item => {
                const div = document.createElement('div');
                div.className = 'media-item';
                div.innerHTML = `
                    <div class="media-img">
                        <img src="${item.cover}" style="width:100%; height:100%; border-radius:10px; object-fit:cover;">
                        ${item.type === 'movie' ? '<div class="movie-tag">HD</div>' : ''}
                    </div>
                    <div class="media-info">
                        <h4>${item.title}</h4>
                        <p>${item.artist}</p>
                    </div>
                    <div style="margin-left:auto; color:var(--highlight);">
                        <i class="fas ${item.type === 'music' ? 'fa-play-circle' : 'fa-film'}"></i>
                    </div>
                `;
                div.onclick = () => item.type === 'music' ? openMusic(item) : openVideo(item);
                listEl.appendChild(div);
            });
        }

        function switchTab(tab) {
            currentTab = tab;
            document.querySelectorAll('.tab-item').forEach(el => el.classList.remove('active'));
            event.target.classList.add('active');
            renderList(document.getElementById('searchInput').value);
        }

        // --- Video Logic ---
        function openVideo(item) {
            audioEl.pause();
            document.getElementById('vidTitle').innerText = item.title;
            videoEl.src = item.url;
            document.getElementById('videoPlayerOverlay').classList.add('active');
            videoEl.play();
        }

        function closeVideo() {
            videoEl.pause();
            document.getElementById('videoPlayerOverlay').classList.remove('active');
        }

        // --- Music Logic ---
        function openMusic(item) {
            videoEl.pause();
            document.getElementById('musicTitle').innerText = item.title;
            document.getElementById('musicArtist').innerText = item.artist;
            document.getElementById('musicCover').src = item.cover;
            audioEl.src = item.url;
            document.getElementById('musicPlayerOverlay').classList.add('active');
            toggleAudio(true);
        }

        function closeMusic() {
            document.getElementById('musicPlayerOverlay').classList.remove('active');
        }

        function toggleAudio(forcePlay = null) {
            const icon = document.getElementById('audioPlayIcon');
            const disk = document.getElementById('disk');
            if(forcePlay || audioEl.paused) {
                audioEl.play();
                icon.className = 'fas fa-pause';
                disk.classList.add('playing');
            } else {
                audioEl.pause();
                icon.className = 'fas fa-play';
                disk.classList.remove('playing');
            }
        }

        // Start
        window.onload = loadMedia;
        document.getElementById('searchInput').addEventListener('input', (e) => renderList(e.target.value));

    </script>
</body>
</html>
