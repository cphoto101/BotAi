<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Premium Stream App</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        :root {
            --bg: #0f172a;
            --card: rgba(30, 41, 59, 0.7);
            --accent: #38bdf8;
            --text: #f8fafc;
            --text-dim: #94a3b8;
            --glass: rgba(255, 255, 255, 0.05);
        }

        body {
            margin: 0; background: var(--bg); color: var(--text);
            font-family: 'Inter', -apple-system, sans-serif;
            background-image: radial-gradient(circle at top right, #1e293b, #0f172a);
            min-height: 100vh;
        }

        /* Loading Animation */
        #loader {
            position: fixed; inset: 0; background: var(--bg); z-index: 100;
            display: flex; flex-direction: column; justify-content: center; align-items: center;
        }
        .pulse {
            width: 60px; height: 60px; background: var(--accent);
            border-radius: 50%; animation: pulse 1.5s infinite ease-in-out;
            box-shadow: 0 0 20px var(--accent);
        }
        @keyframes pulse { 0% { transform: scale(0.8); opacity: 0.5; } 50% { transform: scale(1); opacity: 1; } 100% { transform: scale(0.8); opacity: 0.5; } }

        .container { padding: 16px; max-width: 500px; margin: auto; }

        /* Header UI */
        header { margin-bottom: 24px; text-align: center; }
        header h1 { font-size: 1.5rem; margin: 0; color: var(--accent); }

        /* Tabs */
        .tabs {
            display: flex; background: var(--card); border-radius: 16px;
            padding: 6px; margin-bottom: 20px; backdrop-filter: blur(10px);
            border: 1px solid var(--glass);
        }
        .tab {
            flex: 1; text-align: center; padding: 12px; border-radius: 12px;
            cursor: pointer; transition: 0.3s; font-weight: 600; font-size: 0.9rem;
        }
        .tab.active { background: var(--accent); color: #000; box-shadow: 0 4px 12px rgba(56, 189, 248, 0.3); }

        /* Admin/Forms */
        .admin-card {
            background: var(--card); padding: 20px; border-radius: 20px;
            border: 1px solid var(--accent); margin-bottom: 24px;
            backdrop-filter: blur(10px); display: none;
        }
        input, textarea, select {
            width: 100%; padding: 14px; margin: 8px 0; border-radius: 12px;
            border: 1px solid var(--glass); background: rgba(15, 23, 42, 0.8);
            color: white; box-sizing: border-box; font-size: 0.9rem;
        }
        button {
            width: 100%; padding: 14px; border: none; border-radius: 12px;
            background: var(--accent); color: #000; font-weight: bold;
            cursor: pointer; transition: 0.2s; margin-top: 12px;
        }
        button:active { transform: scale(0.98); }

        /* Movie Card */
        .movie-card {
            background: var(--card); border-radius: 20px; margin-bottom: 16px;
            display: flex; overflow: hidden; border: 1px solid var(--glass);
            backdrop-filter: blur(10px);
        }
        .movie-card img { width: 110px; height: 160px; object-fit: cover; }
        .m-info { padding: 14px; flex: 1; }
        .m-info h3 { margin: 0; font-size: 1.1rem; }
        .key-badge {
            display: inline-block; background: rgba(56, 189, 248, 0.1);
            color: var(--accent); padding: 4px 10px; border-radius: 8px;
            font-size: 0.75rem; margin: 8px 0; font-weight: bold;
        }

        /* Music Card */
        .music-card {
            background: var(--card); border-radius: 20px; padding: 16px;
            margin-bottom: 16px; border: 1px solid var(--glass);
        }
        .music-card h3 { margin: 0 0 12px 0; font-size: 1rem; display: flex; align-items: center; gap: 8px; }
        audio { width: 100%; height: 40px; border-radius: 10px; }
        .lyrics-area {
            font-size: 0.85rem; color: var(--text-dim); margin-top: 12px;
            white-space: pre-line; line-height: 1.5; padding-top: 12px;
            border-top: 1px solid var(--glass);
        }

        .hidden { display: none; }
    </style>
</head>
<body>

    <div id="loader">
        <div class="pulse"></div>
        <p id="greet" style="margin-top:20px; font-weight:500;">Connecting...</p>
    </div>

    <div class="container">
        <header>
            <h1>STREAM HUB</h1>
        </header>

        <div id="adminPanel" class="admin-card">
            <div id="loginSection">
                <h3 style="margin-top:0;">Admin Login</h3>
                <input type="email" id="email" placeholder="Email">
                <input type="password" id="pass" placeholder="Password">
                <button onclick="adminLogin()">Unlock Dashboard</button>
            </div>
            
            <div id="uploadSection" class="hidden">
                <h3 style="margin-top:0;">Upload Content</h3>
                <select id="upType" onchange="toggleForm()">
                    <option value="movie">Movie Post</option>
                    <option value="music">Music Track</option>
                </select>
                <div id="mForm">
                    <input type="text" id="mTitle" placeholder="Movie Title">
                    <input type="text" id="mImg" placeholder="Image Direct Link (URL)">
                    <input type="text" id="mKey" placeholder="Access Key">
                    <textarea id="mReview" placeholder="Quick Review..." rows="3"></textarea>
                </div>
                <div id="muForm" class="hidden">
                    <input type="text" id="muTitle" placeholder="Song Title">
                    <input type="text" id="muUrl" placeholder="Direct MP3/Telegram URL">
                    <textarea id="muLyrics" placeholder="Lyrics..." rows="3"></textarea>
                </div>
                <button onclick="postData()" style="background:#4ade80;">Post to App</button>
                <button onclick="logout()" style="background:#444; color:white;">Sign Out</button>
            </div>
        </div>

        <div class="tabs">
            <div class="tab active" onclick="setTab('movie')">MOVIES</div>
            <div class="tab" onclick="setTab('music')">MUSIC</div>
        </div>

        <div id="movieList"></div>
        <div id="musicList" class="hidden"></div>
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/9.22.0/firebase-app.js";
        import { getAuth, signInWithEmailAndPassword, signOut, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/9.22.0/firebase-auth.js";
        import { getFirestore, collection, addDoc, onSnapshot, query, orderBy } from "https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore.js";

        const firebaseConfig = {
            apiKey: "AIzaSyCdyEiklUPrEL6TklIDyOh_F-PhgCyCjLw",
            authDomain: "zzaro0.firebaseapp.com",
            projectId: "zzaro0",
            storageBucket: "zzaro0.firebasestorage.app",
            messagingSenderId: "197891222875",
            appId: "1:197891222875:web:8897ba4de2829eeb0d3e7e"
        };

        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getFirestore(app);

        const tg = window.Telegram.WebApp;
        tg.expand();
        tg.headerColor = "#0f172a";

        // Admin Telegram ID á€…á€…á€ºá€›á€”á€º
        const ADMIN_ID = 1924452453; 

        window.onload = () => {
            const u = tg.initDataUnsafe.user;
            if(u) document.getElementById('greet').innerText = `Welcome, ${u.first_name}`;
            if(u && u.id === ADMIN_ID) document.getElementById('adminPanel').style.display = 'block';
            setTimeout(() => {
                document.getElementById('loader').style.opacity = '0';
                setTimeout(() => document.getElementById('loader').style.display = 'none', 500);
            }, 2000);
        };

        // Admin Auth Logic
        onAuthStateChanged(auth, user => {
            document.getElementById('loginSection').classList.toggle('hidden', !!user);
            document.getElementById('uploadSection').classList.toggle('hidden', !user);
        });

        window.adminLogin = () => {
            const e = document.getElementById('email').value;
            const p = document.getElementById('pass').value;
            signInWithEmailAndPassword(auth, e, p).catch(err => alert("Login Failed: " + err.message));
        };
        window.logout = () => signOut(auth);

        // UI Tabs & Form Logic
        window.toggleForm = () => {
            const isM = document.getElementById('upType').value === 'movie';
            document.getElementById('mForm').classList.toggle('hidden', !isM);
            document.getElementById('muForm').classList.toggle('hidden', isM);
        };

        window.setTab = t => {
            document.querySelectorAll('.tab').forEach(el => el.classList.remove('active'));
            event.target.classList.add('active');
            document.getElementById('movieList').classList.toggle('hidden', t !== 'movie');
            document.getElementById('musicList').classList.toggle('hidden', t !== 'music');
        };

        // Firestore Posting Logic
        window.postData = async () => {
            const type = document.getElementById('upType').value;
            try {
                if(type === 'movie') {
                    await addDoc(collection(db, "movies"), {
                        title: document.getElementById('mTitle').value,
                        img: document.getElementById('mImg').value,
                        key: document.getElementById('mKey').value,
                        review: document.getElementById('mReview').value,
                        createdAt: Date.now()
                    });
                } else {
                    await addDoc(collection(db, "music"), {
                        title: document.getElementById('muTitle').value,
                        url: document.getElementById('muUrl').value,
                        lyrics: document.getElementById('muLyrics').value,
                        createdAt: Date.now()
                    });
                }
                alert("Published Successfully!");
                // Clear Inputs
                document.querySelectorAll('input, textarea').forEach(i => i.value = "");
            } catch(e) { alert("Error: " + e.message); }
        };

        // Realtime Data Streaming
        onSnapshot(query(collection(db, "movies"), orderBy("createdAt", "desc")), s => {
            const list = document.getElementById('movieList');
            list.innerHTML = "";
            s.forEach(doc => {
                const d = doc.data();
                list.innerHTML += `
                <div class="movie-card">
                    <img src="${d.img || 'https://via.placeholder.com/100x150'}" onerror="this.src='https://via.placeholder.com/100x150'">
                    <div class="m-info">
                        <h3>${d.title}</h3>
                        <div class="key-badge">ðŸ”‘ ${d.key}</div>
                        <p style="font-size:0.85rem; color:var(--text-dim); margin:0;">${d.review}</p>
                    </div>
                </div>`;
            });
        });

        onSnapshot(query(collection(db, "music"), orderBy("createdAt", "desc")), s => {
            const list = document.getElementById('musicList');
            list.innerHTML = "";
            s.forEach(doc => {
                const d = doc.data();
                list.innerHTML += `
                <div class="music-card">
                    <h3><span>ðŸŽµ</span> ${d.title}</h3>
                    <audio controls preload="none">
                        <source src="${d.url}" type="audio/mpeg">
                        Your browser does not support audio.
                    </audio>
                    ${d.lyrics ? `<div class="lyrics-area">${d.lyrics}</div>` : ''}
                </div>`;
            });
        });
    </script>
</body>
</html>
